{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="/jquery-ui-1.8.13.custom.css">
<script src="/jquery-ui-1.8.13.custom.min.js"></script>
<script>

/*
 * Enable from-prefix autocompleting search box.
 */
function enableFromPoolSearch(data) {

    console.log("Enabling search box.");

    var pools = Array();

    for (p in data) {

        console.log("Appending element " + data[p].name);
        pools.push(data[p].name);

    }

    $("#from-pool").autocomplete({ 'source': pools });

}

function showAllocContainer(e) {

    if (e.currentTarget.id == 'radio-from-prefix') {
        $("#from-prefix_container").css('display', 'block');
        $("#from-pool_container").css('display', 'none');
        $("#prefix_data_form").css('display', 'none');
    } else if (e.currentTarget.id == 'radio-from-pool') {
        $("#from-prefix_container").css('display', 'none');
        $("#from-pool_container").css('display', 'block');
        $("#prefix_data_form").css('display', 'none');
    } else {
        $("#from-prefix_container").css('display', 'none');
        $("#from-pool_container").css('display', 'none');
        $("#prefix_data_form").css('display', 'block');
    }

}

$(function () {

    // fetch data for pool search box
    $.getJSON('{{ h.url(controller="xhr", action="list_pool") }}', {'schema_id': {{ c.schema.id }}}, enableFromPoolSearch);

    // Enable actions on the option buttons
    $('input[name="prefix_alloc_method"]').change(showAllocContainer);


});
</script>
{% endblock %}

{% block content %}

<h2>Add prefix</h2>

<div style="padding: 15px;">
<h3>Prefix allocation method</h3>
<table>
	<tr>
		<td width="120" valign="top">
            <input id="radio-from-pool" type="radio" name="prefix_alloc_method" value="from-pool">
            <label for="radio-from-pool">From pool</label>
        </td>
		<td>Get a prefix from a pre-defined prefix pool.</td>
	</tr>
	<tr>
		<td valign="top">
            <input id="radio-from-prefix" type="radio" name="prefix_alloc_method" value="from-prefix">
            <label for="radio-from-prefix">From prefix</label>
        </td>
		<td>Get a prefix allocated from another prefix.</td>
	</tr>
	<tr>
		<td valign="top">
            <input id="radio-manual" type="radio" name="prefix_alloc_method" value="manual">
            <label for="radio-manual">Manual</label>
        </td>
		<td>Specify all data manually</td>
	</tr>
</table>
</div>

<div style="padding: 15px; display: none;" id="from-pool_container">
    <h3>Choose pool</h3>
	<input id="from-pool" type="text" name="from-pool">
</div>
<div style="padding: 15px; display: none;" id="from-prefix_container">
    <h3>Choose prefix</h3>
	<input type="text" name="from-prefix">
</div>

<div id="prefix_data_form" style="padding: 15px; display: none;">
<form method="post" action="{{ h.url(controller="prefix", action="add") }}">
<table>
    <tr>
        <td>Prefix</td>
        <td><input type="text" name="prefix" value="{{ c.prefix }}"></td>
    </tr>
    <tr>
        <td>Family</td>
        <td>
			<select name="family">
				<option value="4">IPv4
				<option value="6">IPv6
			</select>
		</td>
    </tr>
    <tr>
        <td>Description</td>
        <td><input type="text" name="description"></td>
    </tr>
    <tr>
        <td>Node</td>
        <td><input type="text" name="node"></td>
    </tr>
    <tr>
        <td>Type</td>
        <td>
			<select name="type">
				<option value="assignment">Assignment
				<option value="host">Host
				<option value="reservation">Reservation
			</select>
		</td>
    </tr>
    <tr>
        <td>Country</td>
        <td><input type="text" name="country"></td>
    </tr>
    <tr>
        <td>SPAN order</td>
        <td><input type="text" name="span_order"></td>
    </tr>
    <tr>
        <td>Alarm priority</td>
        <td>
			<select name="alarm_priority">
				<option value="low">low
				<option value="medium">medium
				<option value="high">high
			</select>
		</td>
    </tr>
	<tr>
		<td>&nbsp;</td>
		<td><input type="submit" value="Add"></td>
	</tr>
</table>
</form>
</div>

{% endblock %}
